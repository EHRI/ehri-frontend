
@import play.api.libs.json.JsValue

@(template: (GuidePage, (Guide, List[GuidePage])), page: utils.search.ItemPage[(Concept,utils.search.SearchHit)], params: utils.search.SearchParams, links: Map[String, Long], json: JsValue)(implicit userOpt: Option[UserProfile], request: RequestHeader, prefs: utils.SessionPrefs, globalConfig: global.GlobalConfig, lang: Lang, flash: Flash)


@import play.api.libs.json._

@js = {
	<script src="//cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
	<script type="text/javascript">
		templateParams = "@template._1.params".replace("&amp;","&");
		redIcon_URL = "@controllers.core.routes.Assets.at("images/marker-icon-red.png")";
		MAP_URL = "@controllers.portal.routes.Guides.layoutRetrieval(template._2._1.path, template._1.path)";
		$originalMarkers = @Html(Json.stringify(json));
	</script>
    	<script type="text/javascript" src="@controllers.portal.routes.Assets.versioned("js/portal-guide-map.js")"></script>
}
@css = {
	<link rel="stylesheet" href="//cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
}


@optionalContent = {

	@params.query match {
		case Some(text) => {
			<section class="archival-context panel-details repository">
			<div class="panel-heading">
				<h3>
					Search results
				</h3>
			</div>
			<div class="panel-body">
				<ul class="list-unstyled">
				    @page.items.map { case(item, hit) =>
				        @defining(Some(hit.id)) { implicit descriptionId =>
				            <li>

					    <div class="search-item" id="@item.id">

						@item.model.descriptions.headOption.map { desc =>
							@if(desc.longitude.nonEmpty) {
								<a class="zoom-to" href="#map" data-id="@item.id" data-longitude="@desc.longitude" data-latitude="@desc.latitude"><span class=" glyphicon glyphicon-map-marker"></span></a> 
							}
						}
					                @guideItem(item, hit, controllers.portal.routes.Guides.layoutRetrieval(template._2._1.path, template._1.path), Some(template._2._1.path), template._1.layout)
					    </div>
				            </li>
				        }
				    }
				</ul>

                			@common.pagination(page)
			</div>
		</section>
		}
		case _ => {
			@Html(views.Helpers.renderMarkdown(template._1.description.getOrElse("")))
		}
	}
}
@p.layout.guideLayout(template, js, css, optionalContent = Some(optionalContent)) {
	<article>
		<header>
			<h1>@template._1.name</h1>
			<form role="form" action="@controllers.portal.routes.Guides.layoutRetrieval(template._2._1.path, template._1.path)">
				<ul class="nav nav-pills nav-ehri nav-ehri-black nav-justified">
					<li><input class="nav-ehri nav-ehri-black nav-ehri-input" name="q" placeholder="Quick Search" /></li>
					<li><button type="submit" class="nav-ehri nav-ehri-black nav-ehri-input">Search</button></li>
				</ul>
			</form>
		</header>
		<section>
			<div id="map" style="height:400px;"></div>
		</section>
		<footer>
		</footer>
	</article>


}
