@(template: (GuidePage, (Guide, List[GuidePage])), page: utils.search.ItemPage[(Concept,utils.search.SearchHit)], params: utils.search.SearchParams)(implicit userOpt: Option[UserProfile], request: RequestHeader, prefs: utils.SessionPrefs, globalConfig: global.GlobalConfig, lang: Lang, flash: Flash)

@import models.{GuidePage, Guide}

@js = {
	<script type="text/javascript">
	$(document).ready(function() {
		var loadOrganisation = function($ul, $href) {
			$.get(
                $href,
                function(data) {
                	var $data = $("<ul />");
                	$data.html(data)
                	$data.find("li").removeClass("facet").addClass("item-wrapper")
                	$data.find("input[type='checkbox']").remove()
                	$ul.html($data.html());
                },
                "html"
            );
		}
		$(".content-results").on("click", "a[href]", function(e) {
            e.preventDefault();
			var $elem = $(this),
				$href = $elem.attr("href"),
				$parent = $elem.parents("li:first"),
				$ul = $parent.find("ul:first")
			if($ul === "undefined" || $ul.length === 0) {
				$parent.append($("<ul />", {"class" : "list-item hierarchy"}))
				var $ul = $parent.find("ul:first")
				loadOrganisation($ul, $href);
			} else {
				var $li = $ul.find("li:first");
				if($li === "undefined" || $li.length === 0) {
					loadOrganisation($ul, $href);
				} else {
					$ul.toggle()
				}
			}

		});
	});
	</script>
}

@p.layout.guideLayout(template, scripts = js) {
	<article>
		<header>
			<form role="form" action="@controllers.portal.routes.Guides.layoutRetrieval(template._2._1.path, template._1.path)">
				<ul class="nav nav-pills nav-ehri nav-ehri-black nav-justified">
					<li><input class="nav-ehri nav-ehri-black nav-ehri-input" name="q" placeholder="Quick Search" /></li>
					<li><button type="submit" class="nav-ehri nav-ehri-black nav-ehri-input"><span class="glyphicon glyphicon-search"></span><span class="text-hide">Search</span></button></li>
				</ul>
			</form>
		</header>
		<section>
			<section class="content-results">
				<ul class="list-item hierarchy">
				    @page.items.map { case(item, hit) =>
				        @defining(Some(hit.id)) { implicit descriptionId =>
				            <li class="item-wrapper">

				                @guideItem(item, hit, controllers.portal.routes.Guides.layoutRetrieval(template._2._1.path, template._1.path), Some(template._2._1.path), template._1.layout)
				            </li>
				        }
				    }
				</ul>
			</section>
		</section>
		<footer>
			@common.pagination(page)
		</footer>
	</article>

}
