@(template: (GuidesPage, (GuidesData, List[GuidesPage])), page: utils.search.ItemPage[(Any,utils.search.SearchHit)], params: utils.search.SearchParams, pageParam: String = "page")(implicit userOpt: Option[UserProfile], request: RequestHeader, prefs: utils.SessionPrefs, globalConfig: global.GlobalConfig, lang: Lang, flash: Flash)


@page.items.map { case(item, hit) =>
    
    @defining(Some(hit.id)) { implicit descriptionId =>
            @item match {
                case d: HistoricalAgent => {
        <li class="facet" data-target="@d.id" >
            <input type="checkbox" name="@template._1.path,[]" value="@d.id" /> 
                    <a class="item-title">@d.toStringLang</a>
                }
                case d: Concept => {
        <li class="facet" data-target="@d.id" >
            <input type="checkbox" name="@template._1.path,[]" value="@d.id" /> 
                    <span class="item-title">
                        @**
                            @d.broaderTerms.map { bt =>
                                <span class="item-parent">
                                    @bt.toStringLang
                                </span>
                            }
                        **@
                        @template._1.layout match { 
                            case "organisation" => {
                                @if(d.childCount.getOrElse(0) > 0) {
                                    <a href="@controllers.portal.routes.Guides.layoutRetrieval(template._2._1.path, template._1.path)?parent=@d.id">
                                } else {
                                    <a>
                                }
                            } 
                            case _ => {
                                <a>
                            }
                        }
                            @d.toStringLang
                        </a>
                    </span>
                    @if(d.childCount.getOrElse(0) > 0) {
                        <ul></ul>
                    }
                }
                case _ => {
                    ""
                }
            }
    }
    </li>

}
@if(page.hasMultiplePages) {
    @if(page.numPages >= page.page.toInt + 1) {
        <li class="facet-scroll" data-target="@utils.joinPath(request.path, request.queryString.updated(pageParam, Seq((page.page.toInt + 1).toString)))">Loading</li>
    }
}