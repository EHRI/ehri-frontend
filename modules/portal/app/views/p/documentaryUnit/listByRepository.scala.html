@(page: utils.search.ItemPage[(DocumentaryUnit,utils.search.SearchHit)], params: utils.search.SearchParams, facets: List[utils.search.AppliedFacet], action: Call, watched: List[AnyModel] = Nil)(implicit userOpt: Option[UserProfile], request: RequestHeader, prefs: utils.SessionPrefs, globalConfig: global.GlobalConfig, lang: Lang, flash: Flash, context: Option[Holder[_]] = None)

@headerLink(r: Repository) = {
    <h2 class="search-group-heading">
        <a class="alt" href="@controllers.portal.routes.Portal.browseRepository(r.id)">@r.toStringLang</a>
    </h2>
}

@itemByHolderList(docs: Seq[(DocumentaryUnit,utils.search.SearchHit)], lastOpt: Option[(DocumentaryUnit,utils.search.SearchHit)]) = {
    @docs.headOption.map { case (doc, hit) =>
        @lastOpt.map { case (last, lhit) =>
            @if(last.holder != doc.holder) {
                @doc.holder.map { repo =>
                    @headerLink(repo)
                }
            }
        }.getOrElse {
            @doc.holder.map { repo =>
                @headerLink(repo)
            }
        }
        <div class="indented-search-item">
            @searchItem(doc, hit, watched.exists(_.id == doc.id), showRepository=false)
        </div>
    }
    @if(!docs.isEmpty) {
        @itemByHolderList(docs.tail, docs.headOption)
    }
}

@p.layout.portalLayout(Messages("portal.browse.documents"), EntityType.DocumentaryUnit.toString) {
    @p.searchForm(page, params, action, autofocus = false) {
        @itemByHolderList(page.items, None)
    } {
        @p.facetList(page.facets, action)
    }
}