<script lang="ts">

import Dashboard from './components/_dashboard';
import MixinUtil from './components/_mixin-util';

import {ConfigType} from "./types";
import {DashboardApi} from "./dashboard-api";

// These variables are expected to be in the window global scope
// and are generated by server-side data.
const CONFIG = (window as any).CONFIG as ConfigType;
const SERVICE = (window as any).SERVICE as any;

export default {
  components: {Dashboard},
  mixins: [MixinUtil],
  data: function() {
    return {
      config: CONFIG,
      api: new DashboardApi(SERVICE),
      error: null,
    }
  },
  methods: {
    setError: function(err: string, exc?: Error) {
      this.error = err + (exc ? (": " + exc.message) : "");
    },
  },
}
</script>

<template>
  <div id="dashboard-container" class="app-content">
    <div v-if="error" id="app-error-notice" class="alert alert-danger alert-dismissable">
      <span class="close" v-on:click="error = null">&times;</span>
      {{error}}
    </div>
    <dashboard
        v-bind:config="config"
        v-bind:api="api"
        v-on:error="setError"
        />
  </div>
</template>
