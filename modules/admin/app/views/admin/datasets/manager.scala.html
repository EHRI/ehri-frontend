@(item: Repository, isVersioned: Boolean)(implicit userOpt: Option[UserProfile], req: RequestHeader, conf: AppConfig, messages: Messages, md: MarkdownRenderer, prefs: SessionPrefs, flash: Flash)

@styles = {
    <link href="@controllers.admin.routes.AdminAssets.versioned("css/datasets.css")" rel="stylesheet">
}

@breadcrumbs = {
    @views.html.common.infobar {
        @item.country.map { country =>
            <li>
                <a href="@controllers.countries.routes.Countries.get(country.id)">@country.toStringLang</a>
            </li>
        }
        <li>
            <a href="@controllers.institutions.routes.Repositories.get(item.id)">@item.toStringLang</a>
        </li>
        <li class="active">
            <a href="@controllers.datasets.routes.ImportDatasets.manager(item.id)">@Messages("ingest.datasets")</a>
        </li>
    }
}

@views.html.admin.layout.adminSinglePageAppLayout(Messages("repository.data", item.toStringLang), styles = styles, breadcrumbs = breadcrumbs) {
    <script src="@controllers.datasets.routes.ImportDatasets.jsRoutes()"></script>
} {
    <script src="@controllers.admin.routes.AdminAssets.versioned("js/datasets/app.js")"></script>
    <script>
            Vue.createApp({
                render: function() {
                    return Vue.h(App.default, {
                        service: datasetApi.controllers,
                        config: {
                            repoId: "@item.id",
                            versioned: @isVersioned,
                            input: "@FileStage.Input",
                            output: "@FileStage.Output",
                            config: "@FileStage.Config",
                            admin: @userOpt.forall(_.isAdmin),
                            websocketHandler: "@controllers.admin.routes.AdminAssets.versioned("js/datasets/worker.js")",
                            monitorUrl: jobId => datasetApi.controllers.admin.Tasks.taskMonitorWS(jobId)
                                    .absoluteURL(location.protocol === "https:")
                                    .replace(/^http/, "ws"),
                            defaultTab: "input",
                            maxPreviewSize: @conf.configuration.get[Int]("ehri.admin.dataManager.maxPreviewSize"),
                        }
                    });
                },
            }).mount("#vue-app");
    </script>
}
