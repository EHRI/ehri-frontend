@(results: Map[String, Seq[services.ingest.EadValidator#Error]], item: Repository, f: play.api.data.Form[String], action: Call)(implicit userOpt: Option[UserProfile], req: RequestHeader, globalConfig: global.GlobalConfig, messages: Messages, md: views.MarkdownRenderer, prefs: utils.SessionPrefs, flash: Flash)

@implicitField = @{ views.html.helper.FieldConstructor(formHelpers.fieldTemplate.f) }

@extraCss = {
}

@views.html.admin.layout.noSidebar(Messages("repository.data.validate"), breadcrumbs = views.html.admin.common.breadcrumbs(List(item)), styles = extraCss) {
    @if(results.nonEmpty) {
        <table id="validation-results" class="table table-bordered table-sm">
            <thead>
                <tr>
                    <td>@Messages("repository.data.validate.file.name")</td>
                    <td>@Messages("repository.data.validate.file.line")</td>
                    <td>@Messages("repository.data.validate.file.pos")</td>
                    <td>@Messages("repository.data.validate.file.error")</td>
                </tr>
            </thead>
            <tbody>
                @results.map { case (name, errs) =>
                    @if(errs.isEmpty) {
                        <tr class="success">
                            <td class="file-name">@name</td>
                            <td colspan="3">@Messages("repository.data.validate.okay")</td>
                        </tr>
                    } else {
                        @errs.zipWithIndex.map { case (err, i) =>
                            <tr class="warning">
                                @if(i == 0) {
                                    <td class="file-name" rowspan="@errs.size">@name</td>
                                }

                                <td class="lineno">@err.line</td>
                                <td class="linepos">@err.pos</td>
                                <td class="ead-error">@err.error</td>
                            </tr>
                        }
                    }
                }
            </tbody>
        </table>
        <hr>
    }
    @helper.form(action = action, 'enctype -> "multipart/form-data") {
        @formHelpers.csrfToken()
        @formHelpers.globalErrors(f)

        @helper.inputFile(f("files"), '_label -> Messages("repository.data.validate.files"), 'multiple -> true)

        @formHelpers.submitButton(Messages("repository.data.validate.submit"))
    }
}
