@(guide: Guide, page: GuidePage, pages: List[GuidePage], items: utils.Page[(HistoricalAgent,utils.search.SearchHit)], params: utils.search.SearchParams, linkCount: Map[String, Long])(implicit userOpt: Option[UserProfile], request: RequestHeader, prefs: utils.SessionPrefs, globalConfig: global.GlobalConfig, lang: Lang, flash: Flash)

@sidebar = {
	@Html(views.Helpers.renderMarkdown(page.description.getOrElse("")))
}

@views.html.p.layout.guideLayout(guide, page, pages, optionalContent = Some(sidebar)) {
	<article>
		<header>
			<h1>@page.name</h1>
			<form role="form" action="@controllers.portal.guides.routes.Guides.layoutRetrieval(guide.path, page.path)">
				<ul class="nav nav-pills nav-ehri nav-ehri-black nav-justified">
					<li><input class="nav-ehri nav-ehri-black nav-ehri-input" name="q" placeholder="Name" /></li>
					<li><button type="submit" class="nav-ehri nav-ehri-black nav-ehri-input"><span class="glyphicon glyphicon-search"></span><span class="text-hide">Search</span></button></li>
				</ul>
			</form>
		</header>
		<section>
			<ul class="list-unstyled">
			    @items.items.map { case(item, hit) =>
			        @defining(Some(hit.id)) { implicit descriptionId =>
			            <li>
                            <div class="search-item" id="@item.id">
                                <h3 class="search-item-heading type-highlight @item.isA.toString">
                                    @item.toStringLang
                                </h3>
                                <div class="search-item-body">
                                    <div class="small">
                                        <a class="popover-accesspoints" data-count="@linkCount.get(item.id).getOrElse(0)" data-target="@item.id"><span class="glyphicon glyphicon-search"></span></a>
                                    </div>
                                    @item.model.descriptions.headOption.map { desc =>
                                        <div class="item-description">
                                            @desc.details.history.map { d =>
                                                <p>@Html(views.Helpers.renderMarkdown(d))</p>
                                            }
                                            @desc.details.generalContext.map { d =>
                                                <p>@Html(views.Helpers.renderMarkdown(d))</p>
                                            }
                                        </div>
                                    }
                                </div>
                            </div>
			            </li>
			        }
			    }
			</ul>
		</section>
		<footer>
			@common.pagination(items)
		</footer>
	</article>

}