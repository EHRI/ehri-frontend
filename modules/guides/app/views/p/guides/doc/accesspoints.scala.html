@(item: DocumentaryUnit, desc: DocumentaryUnitDescriptionF, links: Seq[Link],template: (GuidePage, (Guide, List[GuidePage])))(implicit userOpt: Option[UserProfile], request: RequestHeader, prefs: utils.SessionPrefs, globalConfig: global.GlobalConfig, lang: Lang, flash: Flash)

@import defines._

@accessPointLink(item: models.base.AnyModel, accessPoint: AccessPointF, links: Seq[Link]) = {
  @accessPoint.target(item, links).map { case (link, other) =>
      <li class="resolved-access-point" id="@accessPoint.id">
          <a href="@controllers.portal.guides.routes.Guides.guideFacets(template._2._1.path)?kw=@other.id" data-target="@other.id" class="popover-keyword type-highlight @other.isA.toString">@other.toStringLang</a>
          @link.model.description.map { desc =>
          <small><p class="text-muted">@desc</p></small>
          }
      </li>
  }.getOrElse {
      <li class="unresolved-access-point" id=" @accessPoint.id">
          @Html(views.Helpers.renderMarkdown(accessPoint.name))
          @accessPoint.description.filter(_.trim.isEmpty).map { desc =>
          <small><p class="text-muted">@Html(views.Helpers.renderMarkdown(desc))</p></small>
          }
      </li>
  }
}


@if(links.nonEmpty) {
  @defining(EntityType.DocumentaryUnit.toString) { implicit fieldPrefix =>
    @views.html.p.common.descriptionSection("accessPointLinks", Messages("item.accessPointLinks")) {
        @if(desc.accessPoints.nonEmpty) {
            @AccessPointF.AccessPointType.values.toList.map { accessPointType =>
                @defining(desc.accessPoints.filter(_.accessPointType == accessPointType)) { apLinks =>
                    @if(apLinks.nonEmpty) {
                        <div class="item-text-field">
                            <h4 class="item-text-field-header">@Messages("accessPoint.type." + accessPointType)</h4>
                            <div class="item-text-field-value">
                                <ul class="list-unstyled item-access-point-links">
                                    @apLinks.map { accessPoint =>
                                        @accessPointLink(item, accessPoint, links)
                                    }
                                </ul>
                            </div>
                        </div>
                    }
                }
            }
        }
     }
  }
}