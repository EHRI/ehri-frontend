@(item: DocumentaryUnit, annotations: Seq[Annotation], links: Seq[Link], watched: Seq[String],template: (GuidePage, (Guide, List[GuidePage])))(implicit userOpt: Option[UserProfile], request: RequestHeader, prefs: utils.SessionPrefs, globalConfig: global.GlobalConfig, lang: Lang, flash: Flash)

@import defines._

@wrapParent(doc: DocumentaryUnit)(html: Html) = {
    @doc.parent.map { parent =>
        @wrapParent(parent) {
            <div class="ancestor">
                <h4>@p.guides.doc.linkTo(parent, template._2._1.path)</h4>
                @html
            </div>
        }
    }.getOrElse {
        @html
    }
}

@side = {
  @common.descriptionChoice(item.model.descriptions)
  <p>
    <small class="text-muted">@Messages("portal.guides.annotation")</small><br />
    <small><a href="@controllers.portal.routes.DocumentaryUnits.browse(item.id)">@Messages("portal.guides.seeOnPortal")</a></small>
  </p>
  @defining(EntityType.DocumentaryUnit.toString) { implicit prefix =>
    <section class="archival-context panel-details repository">
        @item.holder.map { holder =>
            <div class="panel-heading">
                <h3>@p.guides.doc.linkTo(holder, template._2._1.path)</h3>
            </div>
            <div class="panel-body">
                @if(!holder.model.primaryDescription.flatMap(_.parallelFormsOfName).isEmpty || !holder.model.logoUrl.isEmpty) {
                    <ul class="list-unstyled other-name-list">
                        @holder.model.primaryDescription.map { d =>
                          @d.parallelFormsOfName.map { pfn =>
                            <li>@pfn</li>
                          }
                        }
                    </ul>
                }
                @holder.model.logoUrl.map { logo =>
                    @defining(holder.url.map(_.toString).getOrElse(request.path)) { url =>
                    <a href="@url">
                        <img class="repository-logo" src="@logo" alt="@item.toStringLang" />
                    </a>
                    }
                }
	            @item.parent.map { parent =>
	                @wrapParent(parent) {
	                    <div class="ancestor">
	                        <h4>@p.guides.doc.linkTo(parent, template._2._1.path)</h4>
	                    </div>
	                }
	            }
	        </div>
	    }
	</section>
 }
}

@p.layout.guideLayout(template, optionalContent = Some(side)) {

    <article class="description-viewport">
        @defining(EntityType.DocumentaryUnit.toString) { implicit fieldPrefix =>
            @defining(annotations) { implicit annotations =>
                @item.model.descriptions.map { desc =>
                    @p.documentaryUnit.description(item, desc, links, annotations)
                }
            }
        }
    </article>
}