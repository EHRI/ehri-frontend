@**
* Render annotation comments around some HTML content
*
*@
@(item: AnyModel, links: List[Link])(implicit userOpt: Option[UserProfile], req: RequestHeader)

@**
  Get the "other" item in this link's targets.
*@
@opposingTarget(item: AnyModel, link: Link) = @{
    link.targets.filterNot(p => item.id == p.id).headOption
}


<div class="annotatable" id="@item.id">
    @defining(links.filter(_.bodies.isEmpty)) { annotationLinks =>
        @if(!annotationLinks.isEmpty) {
            <hr />
            <h3>@Messages("link.linkTo")</h3>
            <ul class="item-annotation-links">
                @* Assume items with an access point body have been rendered previously *@

                @annotationLinks.map { link =>
                    @opposingTarget(item, link).map { other =>
                        <li class="resolved-access-point">
                            <a href="@views.Helpers.urlFor(other)">@other.toStringLang</a>
                            <a class="alt" href="@routes.Links.getAndRedirect(link.id, Some(item.id))">
                                &times;
                            </a>
                            @link.model.description.map { desc =>
                                <p>@desc</p>
                            }
                        </li>
                    }.getOrElse {
                        @link.model.description.map { desc =>
                            <p>@desc</p>
                        }
                    }
                }
            </ul>
        }
    }
</div>